<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قدّم طلبك | Apply Now — درب | Path</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" type="image/png" href="logo.png">
    
    <style>
        :root {
            --primary-green: #1B4D3E;
            --primary-gold: #C4A35A;
            --beige: #F5F0E6;
            --white: #FFFFFF;
            --black: #1a1a1a;
            --gray: #666666;
            --red: #e74c3c;
            --shadow: 0 10px 40px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background: var(--beige); 
            min-height: 100vh; 
            line-height: 1.6; 
        }
        
        body.en { 
            direction: ltr; 
            font-family: 'Poppins', sans-serif; 
        }
        
        .ar-text { display: inline; } 
        .en-text { display: none; }
        body.en .ar-text { display: none; } 
        body.en .en-text { display: inline; }

        /* Header */
        .page-header {
            background: linear-gradient(135deg, var(--primary-green), #2d6b55);
            padding: 20px 5%;
            color: var(--white);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--white);
        }

        .logo img { height: 45px; }
        .logo-text { font-size: 1.4rem; font-weight: 700; }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .lang-toggle {
            display: flex;
            gap: 5px;
            background: rgba(255,255,255,0.1);
            padding: 4px;
            border-radius: 20px;
        }

        .lang-btn {
            padding: 6px 14px;
            border: none;
            background: transparent;
            color: var(--white);
            cursor: pointer;
            border-radius: 16px;
            font-weight: 600;
            transition: var(--transition);
            font-size: 13px;
        }

        .lang-btn.active {
            background: var(--white);
            color: var(--primary-green);
        }

        .back-btn {
            color: var(--white);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        /* Main Content */
        .main-content {
            max-width: 800px;
            margin: -30px auto 50px;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        .form-container {
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .form-header {
            background: var(--primary-green);
            color: var(--white);
            padding: 30px;
            text-align: center;
        }

        .form-header h1 { font-size: 1.8rem; margin-bottom: 5px; }
        .form-header p { opacity: 0.9; font-size: 0.95rem; }

        .form-body { padding: 35px; }

        /* Form Styles */
        .form-section {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid #eee;
        }

        .form-section:last-of-type { border-bottom: none; }

        .form-section-title {
            font-size: 1.1rem;
            color: var(--primary-green);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section-title i { color: var(--primary-gold); }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .form-group { margin-bottom: 18px; }
        .form-group.full-width { grid-column: 1 / -1; }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--black);
        }

        .form-group .required { color: var(--red); }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
            background: var(--white);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(196,163,90,0.2);
        }

        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-group small { display: block; margin-top: 5px; color: var(--gray); font-size: 0.85rem; }

        /* Radio Buttons */
        .radio-group { display: flex; gap: 15px; flex-wrap: wrap; }
        .radio-option { flex: 1; min-width: 120px; }
        .radio-option input { display: none; }

        .radio-option label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 500;
        }

        .radio-option input:checked + label {
            border-color: var(--primary-green);
            background: rgba(27,77,62,0.05);
            color: var(--primary-green);
        }

        .radio-option label:hover { border-color: var(--primary-gold); }

        /* Program Cards */
        .programs-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .program-option { position: relative; }
        .program-option input { display: none; }

        .program-option label {
            display: block;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .program-option input:checked + label {
            border-color: var(--primary-green);
            background: rgba(27,77,62,0.05);
        }

        .program-option input:disabled + label {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .program-option label:hover:not([disabled]) { border-color: var(--primary-gold); }

        .program-option .program-title {
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 5px;
        }

        .program-option .program-dates {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .program-option .program-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-gold);
        }

        .program-option .program-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-top: 8px;
        }

        .program-option .program-status.open { background: #d4edda; color: #155724; }
        .program-option .program-status.closed { background: #f8d7da; color: #721c24; }

        /* Conditional Fields */
        .conditional-field {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: var(--beige);
            border-radius: 10px;
        }

        .conditional-field.show { display: block; }

        /* Checkbox */
        .checkbox-group { display: flex; flex-direction: column; gap: 12px; }

        .checkbox-option { display: flex; align-items: flex-start; gap: 12px; }

        .checkbox-option input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: var(--primary-green);
        }

        .checkbox-option label { cursor: pointer; font-size: 0.95rem; line-height: 1.5; }
        .checkbox-option a { color: var(--primary-green); }

        /* Confirmation Boxes */
        .confirmation-box {
            background: var(--beige);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .confirmation-box .date-display {
            background: var(--white);
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 600;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .confirmation-box .date-display i { color: var(--primary-gold); }

        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: var(--primary-green);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .submit-btn:hover { background: var(--primary-gold); transform: translateY(-2px); }
        .submit-btn:disabled { background: var(--gray); cursor: not-allowed; transform: none; }

        .submit-btn .spinner {
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        .submit-btn.loading .spinner { display: block; }
        .submit-btn.loading .btn-text { display: none; }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Success Message */
        .success-message { display: none; text-align: center; padding: 50px 30px; }
        .success-message.show { display: block; }

        .success-icon {
            width: 90px;
            height: 90px;
            background: var(--primary-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
        }

        .success-icon i { font-size: 2.5rem; color: var(--white); }
        .success-message h2 { color: var(--primary-green); margin-bottom: 12px; }
        .success-message p { color: var(--gray); margin-bottom: 25px; }

        .success-actions { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }

        .success-actions a {
            padding: 12px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .success-actions .btn-primary { background: var(--primary-green); color: var(--white); }
        .success-actions .btn-outline { border: 2px solid var(--primary-green); color: var(--primary-green); }

        .form-body.hidden { display: none; }

        /* Footer */
        .page-footer { text-align: center; padding: 25px; color: var(--gray); }
        .page-footer a { color: var(--primary-green); text-decoration: none; }

        /* Responsive */
        @media (max-width: 768px) {
            .form-body { padding: 25px; }
            .form-row { grid-template-columns: 1fr; }
            .radio-group { flex-direction: column; }
            .radio-option { min-width: 100%; }
            .programs-selection { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="page-header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <img src="logo.png" alt="درب | Path">
                <span class="logo-text">درب | Path</span>
            </a>
            <div class="header-actions">
                <div class="lang-toggle">
                    <button class="lang-btn active" onclick="setLanguage('ar')">عربي</button>
                    <button class="lang-btn" onclick="setLanguage('en')">EN</button>
                </div>
                <a href="index.html" class="back-btn">
                    <i class="fas fa-home"></i>
                    <span class="ar-text">الرئيسية</span>
                    <span class="en-text">Home</span>
                </a>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="form-container">
            <div class="form-header">
                <h1><span class="ar-text">نموذج التقديم</span><span class="en-text">Application Form</span></h1>
                <p><span class="ar-text">املأ النموذج للتقديم على برنامج درب</span><span class="en-text">Fill out the form to apply for Path program</span></p>
            </div>

            <div class="success-message" id="successMessage">
                <div class="success-icon"><i class="fas fa-check"></i></div>
                <h2><span class="ar-text">تم استلام طلبك بنجاح!</span><span class="en-text">Application Submitted!</span></h2>
                <p><span class="ar-text">سنراجع طلبك ونتواصل معك قريباً إن شاء الله</span><span class="en-text">We'll review and contact you soon, In Shaa Allah</span></p>
                <div class="success-actions">
                    <a href="index.html" class="btn-primary"><span class="ar-text">الرئيسية</span><span class="en-text">Home</span></a>
                    <a href="https://wa.me/13187632439" class="btn-outline" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                </div>
            </div>

            <form class="form-body" id="applicationForm">
                
                <!-- اختيار البرنامج -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span class="ar-text">اختيار البرنامج</span>
                        <span class="en-text">Program Selection</span>
                    </h3>
                    
                    <div class="form-group">
                        <label>
                            <span class="ar-text">اختر البرنامج <span class="required">*</span></span>
                            <span class="en-text">Select Program <span class="required">*</span></span>
                        </label>
                        <div class="programs-selection" id="programsContainer">
                            <p style="text-align: center; color: var(--gray); padding: 20px;">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span class="ar-text">جاري تحميل البرامج...</span>
                                <span class="en-text">Loading programs...</span>
                            </p>
                        </div>
                    </div>

                    <!-- تأكيد تاريخ الوصول -->
                    <div class="confirmation-box" id="arrivalConfirmation" style="display: none;">
                        <div class="checkbox-option">
                            <input type="checkbox" id="confirmArrival" name="confirm_arrival" required>
                            <label for="confirmArrival">
                                <span class="ar-text">أؤكد قدرتي على الوصول إلى مطار الأمير محمد بن عبدالعزيز الدولي (المدينة المنورة) في اليوم السابق لبداية البرنامج</span>
                                <span class="en-text">I confirm my ability to arrive at Prince Mohammad bin Abdulaziz International Airport (Madinah) the day before the program starts</span>
                            </label>
                        </div>
                        <div class="date-display" id="arrivalDateDisplay">
                            <i class="fas fa-plane-arrival"></i>
                            <span id="arrivalDateText"></span>
                        </div>
                    </div>

                    <!-- تأكيد التفرغ -->
                    <div class="confirmation-box" id="availabilityConfirmation" style="display: none;">
                        <div class="checkbox-option">
                            <input type="checkbox" id="confirmAvailability" name="confirm_availability" required>
                            <label for="confirmAvailability">
                                <span class="ar-text">أؤكد تفرغي الكامل خلال فترة البرنامج</span>
                                <span class="en-text">I confirm my full availability during the program period</span>
                            </label>
                        </div>
                        <div class="date-display" id="programDatesDisplay">
                            <i class="fas fa-calendar-check"></i>
                            <span id="programDatesText"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <span class="ar-text">نوع السكن المفضل <span class="required">*</span></span>
                            <span class="en-text">Preferred Accommodation <span class="required">*</span></span>
                        </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="acc_shared" name="accommodation" value="مشترك" required>
                                <label for="acc_shared">
                                    <span class="ar-text">مشترك</span>
                                    <span class="en-text">Shared</span>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="acc_double" name="accommodation" value="ثنائي">
                                <label for="acc_double">
                                    <span class="ar-text">ثنائي</span>
                                    <span class="en-text">Double</span>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="acc_single" name="accommodation" value="فردي">
                                <label for="acc_single">
                                    <span class="ar-text">فردي</span>
                                    <span class="en-text">Single</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- المعلومات الشخصية -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-user"></i>
                        <span class="ar-text">المعلومات الشخصية</span>
                        <span class="en-text">Personal Information</span>
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="ar-text">الاسم الكامل (كما في جواز السفر) <span class="required">*</span></span>
                                <span class="en-text">Full Name (as in passport) <span class="required">*</span></span>
                            </label>
                            <input type="text" name="full_name" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="ar-text">رقم الواتساب <span class="required">*</span></span>
                                <span class="en-text">WhatsApp Number <span class="required">*</span></span>
                            </label>
                            <input type="tel" name="whatsapp" placeholder="+1 234 567 8900" required>
                            <small><span class="ar-text">مع رمز الدولة</span><span class="en-text">With country code</span></small>
                        </div>
                        <div class="form-group">
                            <label>
                                <span class="ar-text">رقم هاتف آخر (اختياري)</span>
                                <span class="en-text">Alternative Phone (optional)</span>
                            </label>
                            <input type="tel" name="phone">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="ar-text">البريد الإلكتروني <span class="required">*</span></span>
                                <span class="en-text">Email <span class="required">*</span></span>
                            </label>
                            <input type="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <span class="ar-text">تاريخ الميلاد <span class="required">*</span></span>
                                <span class="en-text">Date of Birth <span class="required">*</span></span>
                            </label>
                            <input type="date" name="dob" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="ar-text">الجنسية <span class="required">*</span></span>
                                <span class="en-text">Nationality <span class="required">*</span></span>
                            </label>
                            <select name="nationality" required>
                                <option value="">-- اختر / Select --</option>
                                <option value="أمريكي">أمريكي / American</option>
                                <option value="بريطاني">بريطاني / British</option>
                                <option value="كندي">كندي / Canadian</option>
                                <option value="أسترالي">أسترالي / Australian</option>
                                <option value="فرنسي">فرنسي / French</option>
                                <option value="ألماني">ألماني / German</option>
                                <option value="هولندي">هولندي / Dutch</option>
                                <option value="بلجيكي">بلجيكي / Belgian</option>
                                <option value="سويدي">سويدي / Swedish</option>
                                <option value="نرويجي">نرويجي / Norwegian</option>
                                <option value="دنماركي">دنماركي / Danish</option>
                                <option value="سويسري">سويسري / Swiss</option>
                                <option value="إيطالي">إيطالي / Italian</option>
                                <option value="إسباني">إسباني / Spanish</option>
                                <option value="تركي">تركي / Turkish</option>
                                <option value="ماليزي">ماليزي / Malaysian</option>
                                <option value="إندونيسي">إندونيسي / Indonesian</option>
                                <option value="باكستاني">باكستاني / Pakistani</option>
                                <option value="هندي">هندي / Indian</option>
                                <option value="بنغلاديشي">بنغلاديشي / Bangladeshi</option>
                                <option value="نيجيري">نيجيري / Nigerian</option>
                                <option value="جنوب أفريقي">جنوب أفريقي / South African</option>
                                <option value="مصري">مصري / Egyptian</option>
                                <option value="أردني">أردني / Jordanian</option>
                                <option value="فلسطيني">فلسطيني / Palestinian</option>
                                <option value="لبناني">لبناني / Lebanese</option>
                                <option value="سوري">سوري / Syrian</option>
                                <option value="عراقي">عراقي / Iraqi</option>
                                <option value="يمني">يمني / Yemeni</option>
                                <option value="سوداني">سوداني / Sudanese</option>
                                <option value="مغربي">مغربي / Moroccan</option>
                                <option value="جزائري">جزائري / Algerian</option>
                                <option value="تونسي">تونسي / Tunisian</option>
                                <option value="ليبي">ليبي / Libyan</option>
                                <option value="صومالي">صومالي / Somali</option>
                                <option value="أخرى">أخرى / Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <span class="ar-text">بلد الإقامة الحالي <span class="required">*</span></span>
                                <span class="en-text">Current Country of Residence <span class="required">*</span></span>
                            </label>
                            <input type="text" name="country" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <span class="ar-text">الجنس <span class="required">*</span></span>
                            <span class="en-text">Gender <span class="required">*</span></span>
                        </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="gender_male" name="gender" value="ذكر" required>
                                <label for="gender_male">
                                    <i class="fas fa-male"></i>
                                    <span class="ar-text">ذكر</span>
                                    <span class="en-text">Male</span>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="gender_female" name="gender" value="أنثى">
                                <label for="gender_female">
                                    <i class="fas fa-female"></i>
                                    <span class="ar-text">أنثى</span>
                                    <span class="en-text">Female</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- مستوى اللغة العربية -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-language"></i>
                        <span class="ar-text">مستوى اللغة العربية</span>
                        <span class="en-text">Arabic Level</span>
                    </h3>

                    <div class="form-group">
                        <label>
                            <span class="ar-text">مستواك الحالي في العربية <span class="required">*</span></span>
                            <span class="en-text">Your Current Arabic Level <span class="required">*</span></span>
                        </label>
                        <select name="arabic_level" required>
                            <option value="">-- اختر / Select --</option>
                            <option value="لا أعرف شيئاً">لا أعرف شيئاً / Complete Beginner</option>
                            <option value="أعرف الحروف">أعرف الحروف / Know Letters</option>
                            <option value="مبتدئ">مبتدئ / Basic</option>
                            <option value="متوسط">متوسط / Intermediate</option>
                            <option value="متقدم">متقدم / Advanced</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <span class="ar-text">ما هو هدفك من تعلم العربية؟ <span class="required">*</span></span>
                            <span class="en-text">What's your goal in learning Arabic? <span class="required">*</span></span>
                        </label>
                        <textarea name="goals" rows="3" required></textarea>
                    </div>
                </div>

                <!-- معلومات إضافية -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-info-circle"></i>
                        <span class="ar-text">معلومات إضافية</span>
                        <span class="en-text">Additional Information</span>
                    </h3>

                    <div class="form-group">
                        <label>
                            <span class="ar-text">كيف سمعت عن درب؟ <span class="required">*</span></span>
                            <span class="en-text">How did you hear about Path? <span class="required">*</span></span>
                        </label>
                        <select name="referral" required>
                            <option value="">-- اختر / Select --</option>
                            <option value="Instagram">Instagram</option>
                            <option value="Facebook">Facebook</option>
                            <option value="YouTube">YouTube</option>
                            <option value="TikTok">TikTok</option>
                            <option value="صديق أو قريب">صديق أو قريب / Friend or Family</option>
                            <option value="مسجد أو مركز إسلامي">مسجد أو مركز إسلامي / Mosque or Islamic Center</option>
                            <option value="Google">Google</option>
                            <option value="أخرى">أخرى / Other</option>
                        </select>
                    </div>

                    <!-- متطلبات غذائية أو صحية -->
                    <div class="form-group">
                        <label>
                            <span class="ar-text">هل لديك أي متطلبات غذائية أو صحية خاصة؟</span>
                            <span class="en-text">Do you have any dietary or health requirements?</span>
                        </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="requirements_no" name="has_requirements" value="no" checked onchange="toggleRequirements()">
                                <label for="requirements_no">
                                    <span class="ar-text">لا</span>
                                    <span class="en-text">No</span>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="requirements_yes" name="has_requirements" value="yes" onchange="toggleRequirements()">
                                <label for="requirements_yes">
                                    <span class="ar-text">نعم</span>
                                    <span class="en-text">Yes</span>
                                </label>
                            </div>
                        </div>
                        <div class="conditional-field" id="requirementsField">
                            <textarea name="requirements" rows="2" placeholder="اذكر المتطلبات هنا... / Mention requirements here..."></textarea>
                        </div>
                    </div>

                    <!-- هل سجل معك شخص آخر -->
                    <div class="form-group">
                        <label>
                            <span class="ar-text">هل يوجد شخص آخر سجّل معك في هذا البرنامج؟</span>
                            <span class="en-text">Is there someone else who registered with you for this program?</span>
                        </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="companion_no" name="has_companion" value="no" checked onchange="toggleCompanion()">
                                <label for="companion_no">
                                    <span class="ar-text">لا</span>
                                    <span class="en-text">No</span>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="companion_yes" name="has_companion" value="yes" onchange="toggleCompanion()">
                                <label for="companion_yes">
                                    <span class="ar-text">نعم</span>
                                    <span class="en-text">Yes</span>
                                </label>
                            </div>
                        </div>
                        <div class="conditional-field" id="companionField">
                            <label><span class="ar-text">اسم الشخص:</span><span class="en-text">Person's name:</span></label>
                            <input type="text" name="companion_name" placeholder="الاسم الكامل... / Full name...">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <span class="ar-text">ملاحظات إضافية (اختياري)</span>
                            <span class="en-text">Additional Notes (optional)</span>
                        </label>
                        <textarea name="notes" rows="3"></textarea>
                    </div>
                </div>

                <!-- جهة اتصال الطوارئ -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-phone-alt"></i>
                        <span class="ar-text">جهة اتصال الطوارئ</span>
                        <span class="en-text">Emergency Contact</span>
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="ar-text">اسم جهة الاتصال <span class="required">*</span></span>
                                <span class="en-text">Contact Name <span class="required">*</span></span>
                            </label>
                            <input type="text" name="emergency_name" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <span class="ar-text">صلة القرابة <span class="required">*</span></span>
                                <span class="en-text">Relationship <span class="required">*</span></span>
                            </label>
                            <input type="text" name="emergency_relation" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <span class="ar-text">رقم الهاتف <span class="required">*</span></span>
                            <span class="en-text">Phone Number <span class="required">*</span></span>
                        </label>
                        <input type="tel" name="emergency_phone" required>
                    </div>
                </div>

                <!-- الموافقات -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-check-circle"></i>
                        <span class="ar-text">الموافقات</span>
                        <span class="en-text">Agreements</span>
                    </h3>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="agreeTerms" name="agree_terms" required>
                            <label for="agreeTerms">
                                <span class="ar-text">أوافق على <a href="terms.html" target="_blank">الشروط والأحكام</a></span>
                                <span class="en-text">I agree to the <a href="terms.html" target="_blank">Terms and Conditions</a></span>
                            </label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="agreeInfo" name="agree_info" required>
                            <label for="agreeInfo">
                                <span class="ar-text">أؤكد أن جميع المعلومات المقدمة صحيحة</span>
                                <span class="en-text">I confirm that all information provided is accurate</span>
                            </label>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    <span class="spinner"></span>
                    <span class="btn-text">
                        <i class="fas fa-paper-plane"></i>
                        <span class="ar-text">إرسال الطلب</span>
                        <span class="en-text">Submit Application</span>
                    </span>
                </button>
            </form>
        </div>
    </main>

    <footer class="page-footer">
        <p>© 2026 <a href="index.html">درب | Path</a></p>
    </footer>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzFQz9BpuFuxPqjL4I07SCM0uZ7O0chhe3yMTLgmiMiJxOAONpAzVeDalocjgzz74Ye/exec';
        
        let programsData = [];

        // Language
        function setLanguage(lang) {
            const body = document.body;
            const buttons = document.querySelectorAll('.lang-btn');
            
            if (lang === 'en') {
                body.classList.add('en');
                body.setAttribute('dir', 'ltr');
                buttons[0].classList.remove('active');
                buttons[1].classList.add('active');
            } else {
                body.classList.remove('en');
                body.setAttribute('dir', 'rtl');
                buttons[0].classList.add('active');
                buttons[1].classList.remove('active');
            }
            localStorage.setItem('path-lang', lang);
        }

        const savedLang = localStorage.getItem('path-lang');
        if (savedLang) setLanguage(savedLang);

        // Toggle conditional fields
        function toggleRequirements() {
            const field = document.getElementById('requirementsField');
            const hasReq = document.getElementById('requirements_yes').checked;
            field.classList.toggle('show', hasReq);
        }

        function toggleCompanion() {
            const field = document.getElementById('companionField');
            const hasComp = document.getElementById('companion_yes').checked;
            field.classList.toggle('show', hasComp);
        }

        // Load programs
        async function loadPrograms() {
            const container = document.getElementById('programsContainer');
            
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?sheet=programs`);
                const programs = await response.json();
                
                programsData = programs.filter(p => p.visible);
                
                if (programsData.length === 0) {
                    container.innerHTML = `
                        <p style="text-align: center; color: var(--gray); padding: 20px;">
                            <i class="fas fa-calendar-xmark"></i><br>
                            <span class="ar-text">لا توجد برامج متاحة حالياً</span>
                            <span class="en-text">No programs available currently</span>
                        </p>
                    `;
                    return;
                }
                
                container.innerHTML = programsData.map(program => `
                    <div class="program-option">
                        <input type="radio" id="program_${program.id}" name="program" value="${program.id}" 
                            ${!program.registration_open ? 'disabled' : ''} 
                            data-start="${program.start_date}" 
                            data-end="${program.end_date}"
                            onchange="updateProgramDates(this)" required>
                        <label for="program_${program.id}">
                            <div class="program-title">
                                <span class="ar-text">${program.title_ar}</span>
                                <span class="en-text">${program.title_en}</span>
                            </div>
                            <div class="program-dates">${program.start_date} — ${program.end_date}</div>
                            <div class="program-price">$${Number(program.price).toLocaleString()}</div>
                            <span class="program-status ${program.registration_open ? 'open' : 'closed'}">
                                <span class="ar-text">${program.registration_open ? 'التسجيل مفتوح' : 'مغلق'}</span>
                                <span class="en-text">${program.registration_open ? 'Open' : 'Closed'}</span>
                            </span>
                        </label>
                    </div>
                `).join('');

                // Check URL for pre-selected program
                const urlParams = new URLSearchParams(window.location.search);
                const programId = urlParams.get('program');
                if (programId) {
                    const radio = document.getElementById(`program_${programId}`);
                    if (radio && !radio.disabled) {
                        radio.checked = true;
                        updateProgramDates(radio);
                    }
                }
                
            } catch (error) {
                console.error('Error loading programs:', error);
                container.innerHTML = `
                    <p style="text-align: center; color: var(--red); padding: 20px;">
                        <span class="ar-text">حدث خطأ في تحميل البرامج</span>
                        <span class="en-text">Error loading programs</span>
                    </p>
                `;
            }
        }

        // Update dates when program selected
        function updateProgramDates(radio) {
            const startDate = radio.dataset.start;
            const endDate = radio.dataset.end;
            
            // Show confirmation boxes
            document.getElementById('arrivalConfirmation').style.display = 'block';
            document.getElementById('availabilityConfirmation').style.display = 'block';
            
            // Calculate arrival date (day before program starts)
            const start = new Date(startDate);
            start.setDate(start.getDate() - 1);
            const arrivalDate = start.toISOString().split('T')[0];
            
            const isArabic = !document.body.classList.contains('en');
            
            document.getElementById('arrivalDateText').textContent = isArabic 
                ? `تاريخ الوصول المطلوب: ${arrivalDate}`
                : `Required arrival date: ${arrivalDate}`;
            
            document.getElementById('programDatesText').textContent = isArabic
                ? `فترة البرنامج: ${startDate} إلى ${endDate}`
                : `Program period: ${startDate} to ${endDate}`;
        }

        // Form submission
        document.getElementById('applicationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            const formData = new FormData(this);
            const data = {
                timestamp: new Date().toISOString(),
                language: document.body.classList.contains('en') ? 'en' : 'ar'
            };
            
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                // Show success
                document.querySelector('.form-body').classList.add('hidden');
                document.getElementById('successMessage').classList.add('show');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error:', error);
                alert('حدث خطأ. يرجى المحاولة مرة أخرى.');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', loadPrograms);
    </script>
</body>
</html>
